# Nix Darwin Kickstarter - Minimal

A basic configuration comprising essential settings for initiating nix-darwin. It can be safely deployed to your system.

## How to Use

1. Install Nix package manager via [Nix Official](https://nixos.org/download.html#nix-install-macos) or [DeterminateSystems/nix-installer](https://github.com/DeterminateSystems/nix-installer).
2. Read all the files in this `minimal` folder, and understand what they do.
   1. If you have trouble understanding, [ryan4yin/nixos-and-flakes-book](https://github.com/ryan4yin/nixos-and-flakes-book) is a good resource to learn nix and flakes.
3. Install Homebrew, see <https://brew.sh/>
   1. Homebrew is required to install most of the GUI apps, App Store's apps, and some CLI apps that are not available in nix's package repository `nixpkgs`.
4. Search `TODO` in this `minimal` folder, and complete all the TODOs.
5. Run the following command in the root of your nix configuration to start your nix-darwin journey(please change `hostname` to your hostname):

   ```bash
    nix build .#darwinConfigurations.MacBookPro.system \
   	--extra-experimental-features 'nix-command flakes'

   ./result/sw/bin/darwin-rebuild switch --flake .#MacBookPro``
   ```

To simplify the command, adding the following content by create a `Makefile` in the root of your nix configuration:

```makefile
# please change 'hostname' to your hostname
deploy:
	nix build .#darwinConfigurations.MacBookPro.system \
	   --extra-experimental-features 'nix-command flakes'

	./result/sw/bin/darwin-rebuild switch --flake .#MacBookPro
```

Then you can run `make deploy` in the root of your nix configuration to deploy your configuration.

## Configuration Structure

Your current nix-darwin configuration's structure should be as follows:

```bash
› tree
.
├── flake.lock  # a lock file generated by nix, you can ignore it for now
├── flake.nix   # the entry point of your nix configuration, you need to add your hostname here
├── modules     # a folder contains all your nix-darwin configuration files
│   ├── apps.nix        # contains all your homebrew & nix apps(both GUI & CLI)
│   ├── host-users.nix  # defines your hostname & all your system users
│   ├── nix-core.nix    # nix's core configuration, you can ignore it for now
│   └── system.nix      # defines your macOS's system configuration(like dock, trackpad, keyboard, finder, loginwindow, etc.)
└── README.md
```

## Notes on Network Proxy

If you are in a network environment that requires proxy(such as China), you may need to set up proxy for nix and homebrew.

Please refer to the `rich-demo` folder for more details:

- [rich-demo/scripts/darwin_set_proxy.py](/rich-demo/scripts/darwin_set_proxy.py)
- [rich-demo/Makefile](/rich-demo/Makefile)
- [rich-demo - homebrew's mirror settings](/rich-demo/modules/homebrew-mirror.nix)

## Hyprland-Dots (JaKooLit) – isoliert einbinden

Diese Repo kann JaKooLits Hyprland-Dots entweder direkt aus dem Flake-Input oder isoliert aus einem vendorten Pfad nutzen.

Varianten:
- Standard: Flake-Input `inputs.hyprland-dots` (siehe `flake.nix`)
- Isoliert (empfohlen): Vendore die Dots nach `nix/vendor/hyprland-dots` – dieser Pfad wird automatisch bevorzugt

Vorgehen (isoliert):
1. Als Submodule einbinden:
   - git submodule add https://github.com/JaKooLit/Hyprland-Dots nix/vendor/hyprland-dots
   - git submodule update --init --recursive
   Alternativ: Repo nach `nix/vendor/hyprland-dots` kopieren.
2. Rebuild:
   - sudo nixos-rebuild switch --flake .#HOST
   - oder: home-manager switch --flake .#USER

Nutzung im Home-Manager:
- Minimal nur die Dots verlinken:
  - Importiere `nix/home/kool-dots.nix` in dein Home-Profile.
- Komplett isoliert mit System-Hyprland und ohne HM-Hyprland:
  - Importiere `nix/home/offnix-kool.nix` (dieses Modul deaktiviert HM’s Hyprland und verlinkt die Dots).

Was passiert:
- `kool-dots.nix` symlinkt die Config-Verzeichnisse aus `Hyprland-Dots/config` nach `~/.config` (z. B. `hypr`, `waybar`, `rofi`, …).
- Falls `nix/vendor/hyprland-dots` existiert, wird dieser Pfad automatisch statt des Flake-Inputs verwendet.
- Laufzeitabhängigkeiten (rofi, waybar, hypr*-Tools, swww, Screenshots, Thunar, Papirus, …) werden als `home.packages` installiert.

Hinweise:
- KWallet wird automatisch installiert; systemweit ist PAM-Entsperren für SDDM/TTY aktiviert.
- Für KDE/Plasma ist die Tastaturbelegung “US intl” per plasma-manager konfiguriert (siehe `nix/home/nixos.nix`).
